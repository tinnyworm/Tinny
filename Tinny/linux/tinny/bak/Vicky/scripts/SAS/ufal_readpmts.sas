/**************************************************************/
/* FALCON                                                     */
/*         Generic Consortium Data Reader, Version ???        */
/*                                                            */
/*         Payments                                           */
/*

$Source: /work/door/falcon/dvl/sas/RCS/ufal_readpmts.sas,v $

$Log: ufal_readpmts.sas,v $
# Revision 1.2  1997/01/08  19:20:57  jcb
# add log message
#

*/

/**************************************************************/

options 
        nocenter 
        linesize=80 
        pagesize=60 
        obs=max 
        errors=1000 
        compress=yes;

/**************************************************************/
/* Assumes that SAS is invoked with -stdio option to allow    */
/* for STDIN and STDOUT filenames                             */
/**************************************************************/

/**************************************************************/
/* Bin the Times                                              */
/**************************************************************/

proc format;
     value $tim_bin 
     '000001'-'010000' = '01'
     '010001'-'020000' = '02'
     '020001'-'030000' = '03'
     '030001'-'040000' = '04'
     '040001'-'050000' = '05'
     '050001'-'060000' = '06'
     '060001'-'070000' = '07'
     '070001'-'080000' = '08'
     '080001'-'090000' = '09'
     '090001'-'100000' = '10'
     '100001'-'110000' = '11'
     '110001'-'120000' = '12'
     '120001'-'130000' = '13'
     '130001'-'140000' = '14'
     '140001'-'150000' = '15'
     '150001'-'160000' = '16'
     '160001'-'170000' = '17'
     '170001'-'180000' = '18'
     '180001'-'190000' = '19'
     '190001'-'200000' = '20'
     '200001'-'210000' = '21'
     '210001'-'220000' = '22'
     '220001'-'230000' = '23'
     '230001'-'235959' = '24'
      other            = '00'
;
run;

/**************************************************************/
/* Bin the $ amounts                                          */
/**************************************************************/


proc format;
   value am2_bin
   00000.01-100.00=000100
   00100.01-200.00=000200
   00200.01-300.00=000300
   00300.01-400.00=000400
   00400.01-500.00=000500
   00500.01-600.00=000600
   00600.01-700.00=000700
   00700.01-800.00=000800
   00800.01-900.00=000900
   0900.01-1000.00=001000
   1000.01-1100.00=001100
   1100.01-1200.00=001200
   1200.01-1300.00=001300
   1300.01-1400.00=001400
   1400.01-1500.00=001500
   1500.01-1600.00=001600
   1600.01-1700.00=001700
   1700.01-1800.00=001800
   1800.01-1900.00=001900
   1900.01-2000.00=002000
   2000.01-2100.00=002100
   2100.01-2200.00=002200
   2200.01-2300.00=002300
   2300.01-2400.00=002400
   2400.01-2500.00=002500
   2500.01-2600.00=002600
   2600.01-2700.00=002700
   2700.01-2800.00=002800
   2800.01-2900.00=002900
   2900.01-3000.00=003000
   3000.01-3200.00=003200
   3200.01-3400.00=003400
   3400.01-3600.00=003600
   3600.01-3800.00=003800
   3800.01-4000.00=004000
   4000.01-4200.00=004200
   4200.01-4400.00=004400
   4400.01-4600.00=004600
   4600.01-4800.00=004800
   4800.01-5000.00=005000
   5000.01-6000.00=006000
   6000.01-7000.00=007000
   7000.01-8000.00=008000
   8000.01-9000.00=009000
 09000.01-10000.00=010000
 10000.01-11000.00=011000
 11000.01-12000.00=012000
 12000.01-13000.00=013000
 13000.01-14000.00=014000
 14000.01-15000.00=015000
 15000.01-16000.00=016000
 16000.01-17000.00=017000
 17000.01-18000.00=018000 
 18000.01-19000.00=019000
19000.01-100000.00=999999
     other         =000000
;
run;

proc format;
   value am1_bin
       0.01-10.00 = 0010
      10.01-20.00 = 0020
      20.01-30.00 = 0030
      30.01-40.00 = 0040
      40.01-50.00 = 0050
      50.01-60.00 = 0060
      60.01-70.00 = 0070
      70.01-80.00 = 0080
      80.01-90.00 = 0090
     090.01-100.00 = 0100
     100.01-110.00 = 0110
     110.01-120.00 = 0120
     120.01-130.00 = 0130
     130.01-140.00 = 0140
     140.01-150.00 = 0150
     150.01-160.00 = 0160
     160.01-170.00 = 0170
     170.01-180.00 = 0180
     180.01-190.00 = 0190
     190.01-200.00 = 0200
     200.01-210.00 = 0210
     210.01-220.00 = 0220
     220.01-230.00 = 0230
     230.01-240.00 = 0240
     240.01-250.00 = 0250
     250.01-260.00 = 0260
     260.01-270.00 = 0270
     270.01-280.00 = 0280
     280.01-290.00 = 0290
     290.01-300.00 = 0300
     300.01-350.00 = 0350
     350.01-400.00 = 0400
     400.01-450.00 = 0450
     450.01-500.00 = 0500
     500.01-600.00 = 0600
     600.01-700.00 = 0700
     700.01-800.00 = 0800
     800.01-900.00 = 0900
     900.01-1000.00 = 1000
     1000.01-1500.00 = 1500
     1500.01-2000.00 = 2000
     2000.01-2500.00 = 2500
     2500.01-3000.00 = 3000
     3000.01-3500.00 = 3500
     3500.01-4000.00 = 4000
     4000.01-4500.00 = 4500
     4500.01-5000.00 = 5000
     5000.01-5500.00 = 5500
     5500.01-6000.00 = 6000
     6000.01-6500.00 = 6500
     6500.01-7000.00 = 7000
     7000.01-7500.00 = 7500
     7500.01-8000.00 = 8000
     8000.01-8500.00 = 8500
     8500.01-9000.00 = 9000
     9000.01-9500.00 = 9500
     9500.01-1000000.00 = 9999
             other = 0000
;
run;     

proc format;
   value am3_bin
  -10000000.00--9500.01 = 79500
      -9500.00--9000.00 = 79000
      -9000.00--8500.00 = 78500
      -8500.00--8000.00 = 78000
      -8000.00--7500.00 = 77500
      -7500.00--7000.00 = 77000
      -7000.00--6500.00 = 76500
      -6500.00--6000.00 = 76000
      -6000.00--5500.00 = 75500
      -5500.00--5000.00 = 75000
      -5000.00--4500.00 = 74500
      -4500.00--4000.00 = 74000
      -4000.00--3500.00 = 73500
      -3500.00--3000.00 = 73000
      -3000.00--2500.00 = 72500
      -2500.00--2000.00 = 72000
      -2000.00--1500.00 = 71500
      -1500.00--1000.00 = 71000
      -1000.00--500.00 = 70500
      -500.00--400.00 = 70400
      -400.00--300.00 = 70300
      -300.00--200.00 = 70200
      -200.00--100.00 = 70100
      -100.00--00.01 = 70001
       0.00-00.00 =    00000
       0.01-50.00 =    00050
     050.01-100.00 =   00100
     100.01-150.00 =   00150
     150.01-200.00 =   00200
     200.01-250.00 =   00250
     250.01-300.00 =   00300
     300.01-350.00 =   00350
     350.01-400.00 =   00400
     400.01-450.00 =   00450
     450.01-500.00 =   00500
     500.01-600.00 =   00600
     600.01-700.00 =   00700
     700.01-800.00 =   00800
     800.01-900.00 =   00900
     900.01-1000.00 =  01000
     1000.01-1500.00 = 01500
     1500.01-2000.00 = 02000
     2000.01-2500.00 = 02500
     2500.01-3000.00 = 03000
     3000.01-3500.00 = 03500
     3500.01-4000.00 = 04000
     4000.01-4500.00 = 04500
     4500.01-5000.00 = 05000
     5000.01-5500.00 = 05500
     5500.01-6000.00 = 06000
     6000.01-6500.00 = 06500
     6500.01-7000.00 = 07000
     7000.01-7500.00 = 07500
     7500.01-8000.00 = 08000
     8000.01-8500.00 = 08500
     8500.01-9000.00 = 09000
     9000.01-9500.00 = 09500
     9500.01-10000000.00 = 09999
;
run;     

/**************************************************************/
/* Input                                                      */
/**************************************************************/

data xyz (compress=yes);

infile STDIN /*recfm=f lrecl=147*/ missover;


input
 
     @1   ACCOUNT       $19.      /* ACCOUNT ID       */
     @20  PMTAMT        $13.      /* Payment Amount   */
     @33  MINDUE        $13.      /* Minimum Due      */
     @46  TOTALDUE      $13.      /* Total Due        */
     @59  BALANCE       $13.      /* Balance          */
     @72  CREDLINE      $10.      /* Credit Line      */
     @82  PMTDATE       $8.       /* Payment Date     */
     @90  DUEDATE       $8.	  /* Due Date         */
     @98  STATDATE      $8.       /* Statement Date   */
     @106  REVERSAL     $1.       /* Payment Reversal */
     @107  PMTMETH      $1.       /* Payment Method   */
;

if (_error_) then
   do;
      file STDERR;
      put 'Error in Record Number' _n_;
      put _infile_;
      delete;
   end;

format pmt_date date7.;
pmt_date = input(pmtdate, yymmdd8.);
pmt_mnth = month(pmt_date);

n_amt = pmtamt*1.0;
n_due = mindue*1.0;
n_bal = balance*1.0;
n_pay = n_bal-n_amt;
n_diff = n_due-n_amt;

amtbin = put(n_amt, am1_bin.);
diffbin = put(n_diff, am3_bin.);
paybin = put(n_pay, am3_bin.);

keep 
    account 
    pmtamt
    mindue
    totaldue
    balance
    credline
    pmtdate
    duedate
    statdate
    reversal
    pmtmeth
    n_amt
    n_due
    n_bal
    n_diff
    n_pay
    diffbin
    paybin
    amtbin;

run;

/*************************************************************/
/* Print sample output records                               */
/*************************************************************/ 

proc print data=xyz(obs=40);
     var 
	account 
    	pmtamt
	mindue
    	totaldue
    	balance
    	credline
    	pmtdate
    	duedate
    	statdate
    	reversal
    	pmtmeth
    	n_amt
    	n_due
    	n_bal
    	n_diff
    	n_pay
	diffbin
	paybin
    	amtbin;
run;


/**************************************************************/
/* Data Analysis                                              */
/**************************************************************/

proc chart data=xyz;
     hbar amtbin /Type=percent missing;
     title 'Amount Paid';
run;

proc chart data=xyz;
     hbar paybin /Type=percent missing;
     title 'Balance - Amount Paid';
run;

proc chart data=xyz;
     hbar diffbin /Type=percent missing;
     title 'Amount Due - Amount Paid';
run;

proc chart data=xyz;
     hbar reversal /type=percent missing;
     title 'Reversal Type';
run;

proc chart data=xyz;
     hbar pmtmeth /type=percent missing;
     title 'Payment Method';
run;

proc chart data=xyz;
     hbar n_diff /type=percent missing;
     title 'Amount Due - Amount Paid';
run;

proc chart data=xyz;
     hbar n_pay /type=percent missing;
     title 'Balance - Amount Paid';
run;

endsas;
