# Makefile for evaluation
#
# This script using 25% data for evaluation. The last part of the select
# file should be the same as the corresponding data directory. For example:
# 		DATA : DATA_DIR/cap1
#		SELECT : select.muse.cap1
#
# It can (and usually should) be run in parallel using
#		make -j<njobs> -l<maxload>
#			njobs: Allow N jobs at once; infinite jobs with no arg.
#			maxload: Don't start multiple jobs unless load is below N.
# See the help of make for detail information (using make --help)
# 
# It will always generate a big score file for each data set,
# <data>.bigScr.gz. The final research file will be named res.comb
# 
# The changes should be made between >>> and <<< in general, unless the
# detailed falconer4 option need to be changed, such as 25% test, nonpost,
# etc. 
#
# dxl: 08/31/2004

SHELL = /bin/sh

#>>>>>> change start from here >>>>>>

DATA = cap1 \
       fdi_0 \
                 fdi_1 \
                 fdi_2 \
                 fdi_3 \
                 fdi_4 \
                 fdi_5 \
                 fdi_6 \
                 fdi_7 \
                 fdi_8 \
                 fdi_9 \
       rbs_0 \
                 rbs_1 \
                 rbs_2 \
                 rbs_3 \
                 rbs_4 \
                 rbs_5 \
                 rbs_6 \
                 rbs_7 \
                 rbs_8 \
                 rbs_9 
RATE = 0.03

MODEL_DIR = /work/price/falcon/ifal_models/uk/fp/fp_uk_crd_v1.0_2004/rel40/Sterling
MODEL_NAME = uk2004fp
DATA_DIR = /work/frauda2/FP_UK/01_data
SEL_DIR = /work/frauda2/FP_UK/01_data/select
EVAL_DIR = ${shell pwd}

## Flags for Falconer4 options
# FP? [YES/NO]
FP = YES
# shrtScr? [YES/NO]
SCR = NO
# API? [YES/NO]
API = NO

#<<<<<< change end here <<<<<<

## Falconer4 options
FALOPT = -R silent
ifeq (${FP}, YES)
	FALOPT += -p mp=70
endif
FALOPT += -t threshold=25,test 
FALOPT += -f noposts 
FALOPT += -d std_kchk,buildcard30
ifeq (${SCR}, YES)
	FALOPT += -s ${EVAL_DIR}/$*.shrtScr.gz
endif
ifeq (${API}, YES)
	FALOPT += -A ${EVAL_DIR}/$*.API.gz
endif

## Binaries
OS = $(shell uname)
ifeq (${OS}, SunOS)
	FALCONER = /work/gold/bin/falconer4
	BIG2RES = /work/gold/bin/big2res
else
	FALCONER = /work/gold/linux/bin/falconer4
	BIG2RES = /work/gold/linux/bin/big2res
endif

BIGSCR_OBJS = $(foreach a, ${DATA}, ${a}.bigScr.gz)

## rules
all : res.comb

res.comb : ${BIGSCR_OBJS}
	zcat $? | ${BIG2RES} -s ${RATE} - $@

%.bigScr.gz : 
	cd ${MODEL_DIR};\
	${FALCONER} \
		-i dir=${DATA_DIR}/$*,select=${SEL_DIR}/select.muse.$* \
		${FALOPT} \
		-b ${EVAL_DIR}/$@ \
		${MODEL_NAME}.cnf > ${EVAL_DIR}/$*.log 2>&1; 

clean : 
	find ./ ! -name Makefile -exec rm {} \;
