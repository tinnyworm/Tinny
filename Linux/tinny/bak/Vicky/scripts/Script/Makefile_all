##################################################################################
# Makefile for all the steps 
#
# This script using data for generating the relative plots and tables
#
# It can (and usually should) be run in parallel using
#		make -j<njobs> -l<maxload> [-f <Makefile of interest>]
#			njobs: Allow N jobs at once; infinite jobs with no arg.
#			maxload: Don't start multiple jobs unless load is below N.
# See the help of make for detail information (using make --help)
# 
# 
# The changes should be made between >>> and <<< in general
# yxc on 1/2005
##################################################################################

SHELL = /bin/sh

#>>>>>> change start from here >>>>>>

DATA = 0407   \
0408   \
0409   \
0410   \
0411   \
0412   \
0501   \
0502   \
0503   

## Working directory

WORK_DIR = /work/aisle09/client/FALCON/FDR/200407_200503_1pct
#>>>>>> change ends from here >>>>>>

SAMPA = ${WORK_DIR}/script/sample_fdr_auths.sh
SAMPC = ${WORK_DIR}/script/sample_fdr_cards.sh
CMRG  = /home/yxc/scripts/Script/col_merge.sh
CHECK = /home/yxc/check/check_all
ADDM  = /home/yxc/scripts/Script/add_more.sh

RESSC = $(foreach a, ${DATA}, ${WORK_DIR}/log/${a}.sample.cards.log) 
RESSA = $(foreach a, ${DATA}, ${WORK_DIR}/log/${a}.sample.auths.log) 
COLMERGE = ${WORK_DIR}/log/col_merge.log
CHECKALL = ${WORK_DIR}/log/check_all.log
ADDMORE  = ${WORK_DIR}/log/add_more.log

## rules
all :  ${RESSA} ${RESSC} ${COLMERGE} ${CHECKALL} ${ADDMORE}

${WORK_DIR}/log/%.sample.cards.log:
	cd ${WORK_DIR};\
	${SAMPC} ${WORK_DIR}/merge/frauds.dat.gz ${WORK_DIR}/filelist/$*.card.filelist CARDS > ${WORK_DIR}/log/$*.sample.cards.log 2>&1 ; 

${WORK_DIR}/log/%.sample.auths.log:
	cd ${WORK_DIR};\
	${SAMPA} ${WORK_DIR}/merge/frauds.dat.gz ${WORK_DIR}/filelist/$*.auth.filelist AUTHS > ${WORK_DIR}/log/$*.sample.auths.log 2>&1 ; 

${WORK_DIR}/log/%merge.log: ${RESSA} ${RESSC}
	${CMRG} -c -a >${WORK_DIR}/log/$*merge.log 2>&1;
  
${WORK_DIR}/log/%all.log: ${RESSA} ${RESSC}
	cd ${WORK_DIR}/merge; \	
	${CHECK} -c ${WORK_DIR}/merge/cards.dat.gz -a ${WORK_DIR}/merge/auths.dat.gz -f  ${WORK_DIR}/merge/frauds.dat.gz >${WORK_DIR}/log/$*all.log 2>&1;

${ADDMORE}: ${RESSA} ${RESSC}
	cd ${WORK_DIR}/merge; \
	${ADDM} -c cards.dat.gz -a auths.dat.gz -f frauds.dat.gz >${WORK_DIR}/log/add_more.log 2>&1;
